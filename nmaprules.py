#!/usr/bin/python

class Classifier:
    pass

rules = []
def rule(fn):
    rules.append(fn)
    return fn

@rule
def initialize(rec):
    rec.append([])

@rule
def dnsRule(rec):
    if rec[2] == "domain" or rec[1].startswith('53/'):
        rec[4].append('dns')

@rule
def ikeRule(rec):
    if rec[1].startswith('500/'):
        rec[4].append('ike')

@rule
def ntpRule(rec):
    if rec[1].startswith('123/') or rec[2] == 'ntp':
        rec[4].append('ntp')

@rule
def smtpRule(rec):
    if rec[1].startswith('25/') or 'smtp' in rec[2]:
        rec[4].append('smtp')

@rule
def snmpRule(rec):
    if rec[1].startswith('161/udp') or rec[2] == 'snmp':
        rec[4].append('snmp')

@rule
def sshRule(rec):
    if rec[1] == '22/tcp' or rec[2] == 'ssh':
        rec[4].append('ssh')

def sslRule(rec):
    if 'ssl' in rec[2] or isSsh(rec):
        rec[4].append('ssl')

@rule
def telnetRule(rec):
    if rec[1] == '23/tcp':
        rec[4].append('telnet')

@rule
def httpRule(rec):
    if 'http' in rec[2] and not sslRule(rec):
        rec[4].append('http')

@rule
def httpsRule(rec):
    if 'http' in rec[2] and sslRule(rec):
        rec[4].append('https')

@rule
def wrappedRule(rec):
    if rec[2] == 'tcpwrapped':
        rec[4] = ['nc']

@rule
def elseRule(rec):
    if len(rec[4])==0:
        rec[4] = ['unknown']

def classify(data):
    for rec in data:
        for rule in rules:
            rule(rec)

