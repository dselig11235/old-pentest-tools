winid="$(xdotool getwindowfocus -f)"
. ~/.profile
. ~/.bashrc
screenshot() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    echo -e "${red}bash-4.3#$nc $@"
    unbuffer "$@" |& unbuffer tee "$temp" |& tail -70
    declare -i sz=`awk 'END {print NR}' "$temp"`
    sz=$(((sz+5)*16))
    rm "$temp"
    import -window "$winid" -crop "800x$sz+12+14" "$out"
}

screenshot_plus() {
    out="$1"
    declare -i add="$2"
    shift 2
    clear
    temp=`mktemp`
    echo -e "${red}bash-4.3#$nc $@"
    "$@" |& tee "$temp" |& tail -70
    declare -i sz=`awk 'END {print NR}' "$temp"`
    sz=$(((sz+1+add)*16))
    rm "$temp"
    import -window "$winid" -crop "800x$sz+12+14" "$out"
}

screenshot_multi() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    declare -i sz=0
    for cmd in "$@"; do
        echo -e "${red}bash-4.3#$nc ${cmd//\\/\\\\}"
        bash -c "$cmd" |& tee "$temp" |& tail -70
        newsz=`awk 'END {print NR}' "$temp"`
        sz=$((sz + (newsz + 1)*16))
    done
    rm "$temp"
    sz=$((sz+5))
    import -window "$winid" -crop "800x$sz+12+14" "$out"
    return 0
}
